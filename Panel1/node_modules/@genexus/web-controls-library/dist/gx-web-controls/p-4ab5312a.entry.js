import{r as e,h as t,H as r,g as s}from"./p-b4b65ebe.js";const i=class{constructor(t){e(this,t),this.mapServices={net:"gxqueryviewerforsd.aspx",java:"qviewer.services.gxqueryviewerforsd"},this.propsNotToPost=["baseUrl","env","mapServices","object","objectCall","propsNotToPost","parameters","elements","dataVersionId"],this.configurationObserver=new MutationObserver(()=>{this.configurationChangedHandler()})}parameterValueChangedHandler(e){e.stopPropagation(),this.getParameters()}elementChangedHandler(e){e.stopPropagation(),this.getElements()}configurationChangedHandler(){this.getParameters(),this.getElements()}componentWillLoad(){this.getParameters(),this.getElements()}componentDidLoad(){this.configurationObserver.observe(this.element,{childList:!0,subtree:!0})}componentDidRender(){this.element.querySelector("form").submit()}disconnectedCallback(){this.configurationObserver.disconnect()}parseObjectToObjectcall(){try{this.objectCall=JSON.parse(this.object)}catch(e){this.objectCall=null}}hasObjectCall(){return Array.isArray(this.objectCall)&&this.objectCall.length>=2}loadObjectNameFromObjectCall(){this.hasObjectCall()&&(this.objectName=this.objectCall[1])}postData(){return this.parseObjectToObjectcall(),this.loadObjectNameFromObjectCall(),[...Object.keys(i.prototype).filter(e=>!this.propsNotToPost.includes(e)).map(e=>t("input",{type:"hidden",name:e,value:this[e]})),t("input",{type:"hidden",name:"Elements",value:this.elements}),t("input",{type:"hidden",name:"Parameters",value:this.parameters})]}getParameters(){const e=[];this.hasObjectCall()?this.objectCall.slice(2).forEach(t=>{const r={};r.Value=encodeURIComponent(t),r.Name="",e.push(r)}):Array.from(document.getElementsByTagName("gx-query-viewer-parameter")).forEach(t=>{const r={};r.Value=encodeURIComponent(t.Value),r.Name=t.Name,e.push(r)}),this.parameters=JSON.stringify(e)}getElements(){const e=[];Array.from(document.getElementsByTagName("gx-query-viewer-element")).forEach(t=>{const r={};r.Name=t.name,r.Title=t.elementTitle,r.Visible=t.visible,r.Type=t.type,r.Axis=t.axis,r.Aggregation=t.aggregation,r.DataField=t.dataField,t.axisOrderType&&(r.AxisOrder={Type:t.axisOrderType},t.axisOrderValues&&(r.AxisOrder.Values=t.axisOrderValues)),t.filterType&&(r.Filter={Type:t.filterType},t.axisOrderValues&&(r.Filter.Values=t.filterValues)),t.expandCollapseType&&(r.ExpandCollapse={Type:t.expandCollapseType},t.axisOrderValues&&(r.ExpandCollapse.Values=t.expandCollapseValues));const s=this.getGrouping(t);Object.keys(s).length>0&&(r.Grouping=s),t.raiseItemClick&&(r.Action={RaiseItemClick:t.raiseItemClick}),Array.from(t.getElementsByTagName("gx-query-viewer-element-format")).forEach(e=>{const s={};s.Picture=e.picture,s.Subtotals=e.subtotals,s.CanDragToPages=e.canDragToPages,s.Style=e.formatStyle,s.TargetValue=e.targetValue,s.MaximumValue=e.maximumValue;const i=Array.from(t.getElementsByTagName("gx-query-viewer-format-style")),a=[],n=[];i.forEach(e=>{"Values"===e.type?a.push({Value:e.value,ApplyToRowOrColumn:e.applyToRowOrColumn,StyleOrClass:e.styleOrClass}):n.push({Value1:e.value1,Value2:e.value2,Operator:e.operator,StyleOrClass:e.styleOrClass})}),a.length>0&&(s.ValuesStyle=a),n.length>0&&(s.ConditionalStyles=n),r.Format=s}),e.push(r)}),this.elements=JSON.stringify(e)}getGrouping(e){return()=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e.groupingGroupByYear&&{GroupByYear:e.groupingGroupByYear}),e.groupingYearTitle&&{YearTitle:e.groupingYearTitle}),e.groupingGroupBySemester&&{GroupBySemester:e.groupingGroupBySemester}),e.groupingSemesterTitle&&{SemesterTitle:e.groupingSemesterTitle}),e.groupingGroupByQuarter&&{GroupByQuarter:e.groupingGroupByQuarter}),e.groupingQuarterTitle&&{QuarterTitle:e.groupingQuarterTitle}),e.groupingGroupByMonth&&{GroupByMonth:e.groupingGroupByMonth}),e.groupingMonthTitle&&{MonthTitle:e.groupingMonthTitle}),e.groupingGroupByDayOfWeek&&{GroupByDayOfWeek:e.groupingGroupByDayOfWeek}),e.groupingDayOfWeekTitle&&{DayOfWeekTitle:e.groupingDayOfWeekTitle}),e.groupingHideValue&&{HideValue:e.groupingHideValue})}render(){return t(r,null,t("iframe",{name:"query_viewer","data-version-id":this.dataVersionId}),t("form",{hidden:!0,target:"query_viewer",action:this.baseUrl+this.mapServices[this.env],method:"POST"},this.postData()))}get element(){return s(this)}};i.style="gx-query-viewer{display:-ms-flexbox;display:flex;-ms-flex:1;flex:1}gx-query-viewer iframe{-ms-flex:1;flex:1;border:0}";export{i as gx_query_viewer}